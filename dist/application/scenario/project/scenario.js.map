{"version":3,"sources":["../../../../src/application/scenario/project/scenario.ts"],"sourcesContent":["import {\n  BadGatewayException,\n  BadRequestException,\n  Injectable,\n  InternalServerErrorException,\n  NotFoundException,\n} from '@nestjs/common';\n\nimport {\n  IDataUpdateProjectFormatted,\n  UpdatedProject,\n} from '../../../domain/entity';\nimport { ProjectRepository } from '../../../domain/repository';\nimport { ProjectId } from '../../../domain/value';\nimport { CustomLogger } from '../../../utility';\nimport {\n  ICreateProjectRequest,\n  IProjectResponse,\n  IUpdateProjectRequest,\n} from '../../interface';\n\nimport { ProjectParser } from './parser';\n\n@Injectable()\nexport class ProjectScenario {\n  readonly parser: ProjectParser;\n\n  constructor(\n    readonly logger: CustomLogger,\n    readonly repository: ProjectRepository,\n  ) {\n    this.logger.setContext(ProjectScenario.name);\n    this.parser = new ProjectParser(this.logger);\n  }\n\n  async pushProject(input: ICreateProjectRequest): Promise<IProjectResponse> {\n    try {\n      const entity = this.parser.convertToProjectEntity(input);\n\n      const result = await this.repository.pushProject(entity);\n\n      return this.parser.convertToReference(result);\n    } catch (error) {\n      if (\n        [BadRequestException, BadGatewayException].includes(error.constructor)\n      ) {\n        throw error;\n      }\n\n      this.logger.error(error);\n      throw new InternalServerErrorException(error.message);\n    }\n  }\n\n  async updateProject(\n    projectId: string,\n    input: IUpdateProjectRequest,\n  ): Promise<IProjectResponse> {\n    try {\n      const project = await this.repository.getById(ProjectId.from(projectId));\n\n      if (!project) {\n        throw new NotFoundException('Project not found');\n      }\n\n      const dataFormatted: IDataUpdateProjectFormatted =\n        this.parser.formatDataUpdateProject(input);\n\n      const updateData: UpdatedProject = project.update(dataFormatted);\n\n      const result = await this.repository.update(updateData);\n\n      return this.parser.convertToReference(result);\n    } catch (error: any) {\n      if (\n        [BadRequestException, BadGatewayException, NotFoundException].includes(\n          error.constructor,\n        )\n      ) {\n        throw error;\n      }\n\n      this.logger.error(error);\n      throw new InternalServerErrorException(error.message);\n    }\n  }\n}\n"],"names":["BadGatewayException","BadRequestException","Injectable","InternalServerErrorException","NotFoundException","ProjectRepository","ProjectId","CustomLogger","ProjectParser","ProjectScenario","pushProject","input","entity","parser","convertToProjectEntity","result","repository","convertToReference","error","includes","constructor","logger","message","updateProject","projectId","project","getById","from","dataFormatted","formatDataUpdateProject","updateData","update","setContext","name"],"mappings":";;;;;;;;;AAAA,SACEA,mBAAmB,EACnBC,mBAAmB,EACnBC,UAAU,EACVC,4BAA4B,EAC5BC,iBAAiB,QACZ,iBAAiB;AAMxB,SAASC,iBAAiB,QAAQ,sCAA6B;AAC/D,SAASC,SAAS,QAAQ,iCAAwB;AAClD,SAASC,YAAY,QAAQ,4BAAmB;AAOhD,SAASC,aAAa,QAAQ,cAAW;AAGzC,OAAO,MAAMC;IAWX,MAAMC,YAAYC,KAA4B,EAA6B;QACzE,IAAI;YACF,MAAMC,SAAS,IAAI,CAACC,MAAM,CAACC,sBAAsB,CAACH;YAElD,MAAMI,SAAS,MAAM,IAAI,CAACC,UAAU,CAACN,WAAW,CAACE;YAEjD,OAAO,IAAI,CAACC,MAAM,CAACI,kBAAkB,CAACF;QACxC,EAAE,OAAOG,OAAO;YACd,IACE;gBAACjB;gBAAqBD;aAAoB,CAACmB,QAAQ,CAACD,MAAME,WAAW,GACrE;gBACA,MAAMF;YACR;YAEA,IAAI,CAACG,MAAM,CAACH,KAAK,CAACA;YAClB,MAAM,IAAIf,6BAA6Be,MAAMI,OAAO;QACtD;IACF;IAEA,MAAMC,cACJC,SAAiB,EACjBb,KAA4B,EACD;QAC3B,IAAI;YACF,MAAMc,UAAU,MAAM,IAAI,CAACT,UAAU,CAACU,OAAO,CAACpB,UAAUqB,IAAI,CAACH;YAE7D,IAAI,CAACC,SAAS;gBACZ,MAAM,IAAIrB,kBAAkB;YAC9B;YAEA,MAAMwB,gBACJ,IAAI,CAACf,MAAM,CAACgB,uBAAuB,CAAClB;YAEtC,MAAMmB,aAA6BL,QAAQM,MAAM,CAACH;YAElD,MAAMb,SAAS,MAAM,IAAI,CAACC,UAAU,CAACe,MAAM,CAACD;YAE5C,OAAO,IAAI,CAACjB,MAAM,CAACI,kBAAkB,CAACF;QACxC,EAAE,OAAOG,OAAY;YACnB,IACE;gBAACjB;gBAAqBD;gBAAqBI;aAAkB,CAACe,QAAQ,CACpED,MAAME,WAAW,GAEnB;gBACA,MAAMF;YACR;YAEA,IAAI,CAACG,MAAM,CAACH,KAAK,CAACA;YAClB,MAAM,IAAIf,6BAA6Be,MAAMI,OAAO;QACtD;IACF;IA1DAF,YACE,AAASC,MAAoB,EAC7B,AAASL,UAA6B,CACtC;aAFSK,SAAAA;aACAL,aAAAA;QAET,IAAI,CAACK,MAAM,CAACW,UAAU,CAACvB,gBAAgBwB,IAAI;QAC3C,IAAI,CAACpB,MAAM,GAAG,IAAIL,cAAc,IAAI,CAACa,MAAM;IAC7C;AAqDF"}